

<!-- ============================================================== -->
<!-- Start right Content here -->
<!-- ============================================================== -->
<div class="main-content">

     <div class="page-content">
          <div class="container-fluid" id="table_change">

               <!-- start page title -->
               <div class="row">
                    <div class="col-12">
                         <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                              <h4 class="mb-sm-0">Category Management</h4>

                              <div class="page-title-right">
                                   <ol class="breadcrumb m-0">
                                        <li class="breadcrumb-item"><a href="javascript: void(0);">Admin</a></li>
                                        <li class="breadcrumb-item active">Category Management</li>
                                   </ol>
                              </div>

                         </div>
                    </div>
               </div>
               <!-- end page title -->

               <div class="card">
                    <div class="card-body">
                         <div class="row">
                              <div class="col-md-4">
                                   <!-- Create Category -->
                                   <h5 class="pb-1">Create Category</h5>
                                   <form>
                                        <div class="mb-4">
                                             <label for="product_name" class="form-label">Category</label>
                                             <input type="text" placeholder="Type here" name="category"
                                                  class="form-control" id="category" />
                                        </div>
                                        
                                        
                                        
                                        <div class="d-grid pb-3">
                                             <a class="btn btn-primary" type="submit" onclick="addCategory()">Create
                                                  category</a>

                                        </div>
                                   </form>
                                   <hr>
                                   <!-- End -->
                                   <h5 class="pb-1">Create Subcategory</h5>
                                   <form>
                                        <div class="mb-4">
                                             <label class="form-label">Select Category</label>
                                             <select  class="form-select" id="category_select">
                                                  <option>Select</option>
                                                  <%for(var i=0;i<data.length;i++){%>
                                                  
                                                       <option><%=data[i].category%></option>

                                                  <%}%>
                                             </select>
                                        </div>
                                        <div class="mb-4">
                                             <label for="product_slug" class="form-label">Sub Category</label>
                                             <input type="text" placeholder="Type here" name="subcategory"
                                                  class="form-control" id="sub_category" />
                                        </div>
                                        
                                        
                                        <div class="d-grid">
                                             <a class="btn btn-primary" type="submit" onclick="addSubategory()">Create
                                                  Subcategory</a>

                                        </div>
                                   </form>
                              </div>
                              <div class="col-md-8">

                                   

                                   <table <table id="datatable-buttons" class="table table-striped table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">>
                                        <thead>
                                             <tr>
                                                  <th>#</th>
                                                  <th>Category</th>
                                                  <th>Sub Category</th>
                                                  <th class="text-end">Action</th>
                                             </tr>
                                        </thead>
                                        <tbody>

                                             <%let a=0%>
                                         
                                                  <%for(var i=0;i<data.length;i++){%>
                                         


                                                       <%if(data[i].subCategory.length){%>

                                                       <%for(var j=0;j<data[i].subCategory.length;j++){%>
                                                            <tr id="row_<%=a%>">
                                                                 <%a++%>
                                                                      <td><b>
                                                                                <%=a%>
                                                                           </b></td>
                                                                      <td id="category_<%=a%>"><b>
                                                                                <%=data[i].category%>
                                                                           </b></td>
                                         
                                                                      <%if(data[i].subCategory.length!=0){%>
                                                                      <td id="subCategory_<%=a%>">
                                                                           <%=data[i].subCategory[j]%>
                                                                      </td>
                                                                 <%}else{%>
                                                                      <td>

                                                                      </td>
                                                                 <%}%>
                                                            
                                                                      <td class="text-end">
                                                                           <a class="btn btn-outline-dark"
                                                                                onclick="deleteCategory('category_<%=a%>')">Delete
                                                                                Category</a>
                                                                           <a class="btn btn-outline-dark"
                                                                                onclick="deleteSubCategory('category_<%=a%>','subCategory_<%=a%>')">Delete
                                                                                Subcategory</a>
                                                                          
                                                                      </td>
                                                            </tr>
                                                            <%}%>
                                                       <%}else{%>

                                                            <tr id="row_<%=a%>">
                                                                 <%a++%>
                                                                      <td><b>
                                                                                <%=a%>
                                                                           </b></td>
                                                                      <td id="category_<%=a%>"><b>
                                                                                <%=data[i].category%>
                                                                           </b></td>
                                         
                                                                      <%if(data[i].subCategory.length!=0){%>
                                                                      <td id="subCategory_<%=a%>">
                                                                           <%=data[i].subCategory[j]%>
                                                                      </td>
                                                                 <%}else{%>
                                                                      <td>

                                                                      </td>
                                                                 <%}%>
                                                            
                                                                      <td class="text-end">
                                                                           <a class="btn btn-outline-dark"
                                                                                onclick="deleteCategory('category_<%=a%>')">Delete
                                                                                Category</a>
                                                                           <a class="btn btn-outline-dark"
                                                                                onclick="deleteSubCategory('category_<%=a%>','subCategory_<%=a%>')">Delete
                                                                                Subcategory</a>
                                                                          
                                                                      </td>
                                                            </tr>


                                                       <%}%>
                                                                 <%}%>
                                         
                                         </tbody>
                                   </table>
                              </div> <!-- .col// -->
                         </div> <!-- .row // -->
                    </div> <!-- card body .// -->
               </div> <!-- card .// -->
          </div>
          <!-- End Page-content -->
     </div>
     <!-- end main content-->

</div>
<!-- END layout-wrapper -->




<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>

<!-- JAVASCRIPT -->
<script src="/admin/libs/jquery/jquery.min.js"></script>
        <script src="/admin/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="/admin/libs/metismenu/metisMenu.min.js"></script>
        <script src="/admin/libs/simplebar/simplebar.min.js"></script>
        <script src="/admin/libs/node-waves/waves.min.js"></script>

        <!-- Required datatable js -->
        <script src="/admin/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="/admin/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        <!-- Buttons examples -->
        <script src="/admin/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
        <script src="/admin/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
        <script src="/admin/libs/jszip/jszip.min.js"></script>
        <script src="/admin/libs/pdfmake/build/pdfmake.min.js"></script>
        <script src="/admin/libs/pdfmake/build/vfs_fonts.js"></script>
        <script src="/admin/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
        <script src="/admin/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
        <script src="/admin/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
        <!-- Responsive examples -->
        <script src="/admin/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="/admin/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>

        <!-- Datatable init js -->
        <script src="/admin/js/pages/datatables.init.js"></script>

        <!-- sweat alert -->
        <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <!-- <script src="sweetalert2.all.min.js"></script> -->

        <script src="/admin/js/app.js"></script>
<!-- ajax -->

<!-- sweat alert -->
<!-- <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script> -->




<!-- function -->

<script>


     // function for create category with validation
     function addCategory(){

          let catError = true;

          function validateCategory() {

               let inpCat = $('#category').val()

               if (inpCat.length == '') {

                    $('#category').css('border-color', '#c70d0d')
                    $('#category').attr("placeholder", "Enter Category")
                    catError = false;
                    return false;
               }
          }

          validateCategory()

          let category = document.getElementById('category').value.toUpperCase()
          //  $('#category').val()
          console.log(category);
          // category = toUpperCase()
          
          if ( catError === true) {

               $.ajax({

                    url: '/admin/add_category',
                    type: 'post',
                    data: {category:category},
                    success: () => {

                         $("#table_change").load(location.href + " #table_change");
                         // $('#table_change').load(window.location.href + "#table_change");
                    }
               })
          }
     }




     // function for Subcategory add with validation
     function addSubategory() {

          event.preventDefault()

          let catError = true;

          function validateCategory() {

               let inpCat = $('#category_select').val()
               

               if (inpCat == 'Select') {

                    $('#category_select').css('border-color', '#c70d0d')
                    $('#category_select').attr("placeholder", "Enter Category")
                    catError = false;
                    return false;
               }
          }



          let subCatError = true;

          function validateSubCategory() {

               let inpSubCat = $('#sub_category').val()

               if (inpSubCat.length == '') {

                    $('#sub_category').css('border-color', '#c70d0d')
                    $('#sub_category').attr("placeholder", "Enter Subcategory")
                    subCatError = false;
                    return false;
               }
          }


          let cat = {

               category: $('#category_select').val(),
               subcategory: document.getElementById('sub_category').value.toUpperCase()
              
          }

          validateCategory()
          validateSubCategory()
          if (subCatError === true && catError === true) {

               $.ajax({

                    url: '/admin/add_subcategory',
                    type: 'post',
                    data: cat,
                    success: () => {

                         $("#table_change").load(location.href + " #table_change");
                         // $('#table_change').load(window.location.href + "#table_change");
                    }
               })
          }
     };

     // function for delete category
     function deleteCategory(cat) {

          let catName = document.getElementById(cat).innerText
          // console.log(catName);
          Swal.fire({
               title: 'Are you sure?',
               text: "You won't be able to revert this!",
               icon: 'warning',
               showCancelButton: true,
               confirmButtonColor: '#3085d6',
               cancelButtonColor: '#d33',
               confirmButtonText: 'Yes, delete it!'
          }).then((result) => {
               if (result.isConfirmed) {
                    Swal.fire(

                         'Deleted!',
                         'Your file has been deleted.',
                         'success',
                         $.ajax({

                              url: '/admin/deleteCategory',
                              type: 'post',
                              data: { catName: catName },
                              success: () => {

                                   $("#table_change").load(location.href + " #table_change");
                                   
                              }

                         })

                    )
               }
          })

     }

     // function for delete subcategory
     function deleteSubCategory(cat, sub) {

          let categorys = {

               catName: document.getElementById(cat).innerText,
               subCatName: document.getElementById(sub).innerText
          }

          Swal.fire({
               title: 'Are you sure?',
               text: "You won't be able to revert this!",
               icon: 'warning',
               showCancelButton: true,
               confirmButtonColor: '#3085d6',
               cancelButtonColor: '#d33',
               confirmButtonText: 'Yes, delete it!'
          }).then((result) => {
               if (result.isConfirmed) {
                    Swal.fire(

                         'Deleted!',
                         'Your file has been deleted.',
                         'success',
                         $.ajax({

                              url: '/admin/deletesSubCategory',
                              type: 'post',
                              data: categorys,
                              success: () => {
                                   console.log("hiiii");
                                   $("#table_change").load(location.href + " #table_change");
                                   
                              }

                         })

                    )
               }
          })

     }



</script>


</body>

